{% extends "base.html" %} 

{% block javascript %}


<script>
  $(document).ready(function(){
    function renderChart(id, data, labels){
      var ctx = $("#"+id)
      var myChart = new Chart(ctx, {
        type: "bar",
        data: {
          labels: labels,
          datasets: [{
            label: "Ventas",
            data: data,
            borderWidth: 1
          }]
        },
        options: {
          scales: {
            y: {
              beginAtZero: true
            }
          }
        }
      });
    }

    function getSalesData(id, type){
      var url = "/sales/sales/data"
      var method = "GET"
      var data = {"type":type}
      $.ajax({
        url: url,
        method: method,
        data: data,
        success: function(responseData){
          renderChart(id, responseData.data, responseData.labels)
        }, error: function(error){
          alert("Ocurri√≥ un error")
        }
      })
    }
    var chartsToRender = $(".render-chart")
    $.each(chartsToRender, function(index, html){
      var $this = $(this)
      if ($this.attr("id") && $this.attr("data-type")){
        getSalesData($this.attr("id"), $this.attr("data-type"))
      }
    })
  })
</script>

{% endblock %} 
{% block content %}

<div class="row">
  <div class="col-12">
    <h1>Ventas</h1>
  </div>
</div>

<div class="row">
  <div class="col">
    <p>Recientes</p>
    <ol>
      {% for order in recent_orders %}
      <li>{{order.order_id}} {{order.total}} {{order.updated}}</li>
      {% endfor %}
    </ol>
  </div>
  <div class="col">
    <p>Enviadas</p>
    <ol>
      {% for order in shipped_orders %}
      <li>{{order.order_id}} {{order.total}} {{order.updated}}</li>
      {% endfor %}
    </ol>
  </div>
  <div class="col">
    <p>Pagadas</p>
    <ol>
      {% for order in paid_orders %}
      <li>{{order.order_id}} {{order.total}} {{order.updated}}</li>
      {% endfor %}
    </ol>
  </div>
</div>


<div class="col">
  <canvas class="render-chart" id="thisWeekSales" data-type="week" width="400" height="400"></canvas>
</div>
{% endblock %}
